<UserControl
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d"
    x:Class="VRCFaceTracking.Avalonia.Views.ModuleRegistryView"
    x:DataType="vm:ModuleRegistryViewModel"
    xmlns="https://github.com/avaloniaui"
    xmlns:controls="clr-namespace:VRCFaceTracking.Avalonia.Controls"
    xmlns:converters="clr-namespace:VRCFaceTracking.Avalonia.Converters"
    xmlns:stars="using:RatingControlSample.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:htControls="clr-namespace:HyperText.Avalonia.Controls;assembly=HyperText.Avalonia"
    xmlns:assets="clr-namespace:VRCFaceTracking.Avalonia.Assets"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:VRCFaceTracking.Core.Models;assembly=VRCFaceTracking.Core"
    xmlns:amodels="clr-namespace:VRCFaceTracking.Avalonia.Models"
    xmlns:vm="clr-namespace:VRCFaceTracking.Avalonia.ViewModels.SplitViewPane"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

  <UserControl.Styles>
    <StyleInclude Source="avares://Avalonia.Xaml.Interactions.Draggable/Styles.axaml" />
  </UserControl.Styles>
  <UserControl.Resources>
    <converters:InstallationStateToTextConverter x:Key="InstallationTextConverter"/>
    <converters:InstallationStateToBoolConverter x:Key="InstallationActiveConverter"/>
  </UserControl.Resources>

  <ScrollViewer DragDrop.AllowDrop="True">
    <StackPanel Classes="Page">
      <StackPanel Orientation="Horizontal">
        <TextBlock Classes="Header" Text="{x:Static assets:Resources.Shell_ModuleRegistry_Content}" />
        <StackPanel
            IsVisible="{Binding NoRemoteModulesDetected}"
            Margin="8,0"
            Orientation="Horizontal"
            Spacing="8"
            VerticalAlignment="Center">
          <PathIcon
              Data="{StaticResource WarningRegular}"
              Foreground="#FF8C00"
              Height="16"
              Width="16" />
          <TextBlock
              FontSize="14"
              FontWeight="Normal"
              Foreground="#FF8C00"
              Text="No internet connection"
              VerticalAlignment="Center" />
          <StackPanel />
        </StackPanel>
      </StackPanel>

      <StackPanel Spacing="12">
        <controls:ContentExample>
          <StackPanel Orientation="Horizontal" Spacing="12">
            <Button x:Name="BrowseLocal" Command="{Binding BrowseLocalCommand}">
              <Button.Content>
                <StackPanel Orientation="Vertical">
                  <PathIcon Data="{StaticResource AddRegular}" Height="24" />
                </StackPanel>
              </Button.Content>
            </Button>
            <TextBlock
                Text="{x:Static assets:Resources.OpenLocalStorageCard_Header}"
                VerticalAlignment="Center"
                x:Name="BrowseLocalText" />
          </StackPanel>
        </controls:ContentExample>

        <controls:ContentExample>
          <Grid RowDefinitions="Auto,Auto">
            <StackPanel
                Grid.Row="0"
                IsVisible="{Binding RequestReinit}"
                Margin="-6,6,0,6"
                Orientation="Horizontal">
              <TextBlock
                  Margin="12,0,6,0"
                  Text="Module data has been changed."
                  VerticalAlignment="Center" />
              <Button
                  Command="{Binding ModuleTryReinitializeCommand}"
                  Content="Reload Modules"
                  VerticalAlignment="Center" />
            </StackPanel>

            <Grid
                ColumnDefinitions="Auto,*"
                Grid.Row="1"
                Height="400"
                HorizontalAlignment="Stretch"
                Margin="-6,0,6,12"
                VerticalAlignment="Stretch">
              <!--  Left-hand content  -->
              <Grid Grid.Column="0" HorizontalAlignment="Left">
                <TabControl HorizontalAlignment="Center"
                            x:Name="TabControl"
                            SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}"
                             >
                  <TabItem
                      FontWeight="SemiBold"
                      Header="Registry"
                      x:Name="Registry">
                    <StackPanel IsVisible="{Binding ModulesDetected}" Margin="0,0,6,0">
                      <StackPanel Orientation="Horizontal" Margin="0,12" Width="350" Spacing="4">
                        <TextBox
                          Text="{Binding SearchText}"
                          Watermark="Search modules..."
                          x:Name="SearchBox" />
                        <Button Width="32" Height="32" ToolTip.Tip="Clear" Click="ClearSearchBox_Click">
                          <TextBlock Text="✕" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Button>
                      </StackPanel>

                      <ListBox
                          ItemsSource="{Binding FilteredModuleInfos}"
                          SelectedItem="{Binding SelectedInfoModule, Mode=TwoWay}"
                          SelectionMode="AlwaysSelected"
                          MaxHeight="305"
                          Width="350"
                          x:Name="ModuleList">
                        <ListBox.ItemTemplate>
                          <DataTemplate x:DataType="models:InstallableTrackingModule">
                            <StackPanel Spacing="4">
                              <StackPanel Orientation="Horizontal">
                                <TextBlock FontWeight="SemiBold" Text="{Binding ModuleName}" />
                                <TextBlock
                                    FontWeight="SemiBold"
                                    IsVisible="{Binding IsInstalled}"
                                    Text="(Installed)" />
                              </StackPanel>
                              <TextBlock FontSize="12" Foreground="{DynamicResource SystemChromeGrayColor}">
                                <Run Text="{Binding AuthorName}" />
                              </TextBlock>
                            </StackPanel>
                          </DataTemplate>
                        </ListBox.ItemTemplate>
                      </ListBox>

                    </StackPanel>
                  </TabItem>
                  <TabItem
                      FontWeight="SemiBold"
                      Header="Installed"
                      x:Name="Installed">
                    <StackPanel IsVisible="{Binding ModulesDetected}" Margin="6,8,0,0">
                      <ListBox
                          Classes="draggable"
                          MaxHeight="400"
                          SelectionMode="AlwaysSelected"
                          ItemsSource="{Binding InstalledModules}"
                          SelectedItem="{Binding SelectedInstalledModule, Mode=TwoWay}"
                          Width="350"
                          x:Name="LocalModuleList">
                        <ListBox.ItemTemplate>
                          <DataTemplate x:DataType="models:InstallableTrackingModule">
                            <Grid ColumnDefinitions="Auto, Auto, *, Auto" VerticalAlignment="Center">

                              <!--  Instantiatable Checkbox  -->
                              <CheckBox
                                  Grid.Column="1"
                                  HorizontalAlignment="Center"
                                  IsChecked="{Binding Instantiatable, Mode=TwoWay}"
                                  Margin="3,0,0,0"
                                  VerticalAlignment="Center" />

                              <!--  Order Display  -->
                              <Grid
                                  ColumnDefinitions="Auto,Auto"
                                  Grid.Column="0"
                                  Margin="3,0">
                                <TextBlock
                                    Grid.Column="0"
                                    Text="{Binding Order}"
                                    VerticalAlignment="Center" />
                                <TextBlock
                                    Grid.Column="1"
                                    Text="."
                                    VerticalAlignment="Center" />
                              </Grid>

                              <!--  Module Information  -->
                              <StackPanel
                                  Grid.Column="2"
                                  Margin="3,0"
                                  Orientation="Vertical"
                                  Spacing="4">
                                <TextBlock
                                    FontWeight="SemiBold"
                                    Text="{Binding ModuleName}"
                                    VerticalAlignment="Center" />
                                <TextBlock
                                    FontSize="12"
                                    Foreground="{DynamicResource SystemChromeGrayColor}"
                                    Text="{Binding AuthorName}"
                                    VerticalAlignment="Center" />
                              </StackPanel>

                              <!--  Up/Down Buttons  -->
                              <StackPanel
                                  Grid.Column="3"
                                  HorizontalAlignment="Right"
                                  Margin="3,0"
                                  Orientation="Horizontal"
                                  Spacing="2">
                                <!--  A workaround for changing order without modifying the InstallableTrackingModule.cs -->
                                <Button
                                    Command="{Binding #LocalModuleList.((vm:ModuleRegistryViewModel)DataContext).DecrementOrderCommand}"
                                    CommandParameter="{Binding}"
                                    Content="↑"
                                    Name="LocalModuleUpButton"
                                    Padding="3" />
                                <Button
                                    Command="{Binding #LocalModuleList.((vm:ModuleRegistryViewModel)DataContext).IncrementOrderCommand}"
                                    CommandParameter="{Binding}"
                                    Content="↓"
                                    Name="LocalModuleDownButton"
                                    Padding="3" />
                              </StackPanel>

                            </Grid>
                          </DataTemplate>
                        </ListBox.ItemTemplate>
                      </ListBox>
                    </StackPanel>
                  </TabItem>
                  <TabItem FontWeight="SemiBold"
                      HorizontalAlignment="Stretch"
                      Header="Profiles"
                      x:Name="Profiles">
                    <DockPanel Margin="6,8,0,0" >
                      <Grid DockPanel.Dock="Top" ColumnDefinitions="*, Auto" HorizontalAlignment="Stretch">
                        <TextBox
                              HorizontalAlignment="Stretch"
                              Grid.Column="0"
                              Watermark="Search profiles or create one..."
                          />
                        <Button
                            Grid.Column="1"
                            Width="32"
                            Height="32"
                            ToolTip.Tip="Clear"
                            Command="{Binding AddNewProfileCommand}">
                          <TextBlock Text="+" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Button>
                      </Grid>
                      <ListBox
                          x:Name="LocalListBox"
                          Classes="draggable"
                          MaxHeight="400"
                          SelectionMode="AlwaysSelected"
                          ItemsSource="{Binding Profiles}"
                          SelectedItem="{Binding SelectedProfile, Mode=TwoWay}">
                        <ListBox.ItemTemplate>
                          <DataTemplate x:DataType="amodels:Profile">
                            <Grid ColumnDefinitions="*, Auto">
                              <TextBlock
                                  Grid.Column="0"
                                  HorizontalAlignment="Stretch"
                                  Text="{Binding Name}"/>
                              <Button
                                  Grid.Column="1"
                                  Width="32"
                                  Height="32"
                                  ToolTip.Tip="Clear"
                                  Command="{Binding #LocalListBox.((vm:ModuleRegistryViewModel)DataContext).RemoveProfile}"
                                  CommandParameter="{Binding}"
                                  Content="-"/>
                            </Grid>
                          </DataTemplate>
                        </ListBox.ItemTemplate>
                      </ListBox>
                    </DockPanel>
                  </TabItem>
                </TabControl>
              </Grid>

              <!--
                We do it this way because we want independent panels for each Left-hand content.
                Carousel uses the same index as TabControl 
                The amount of tabs should always match or we break things or crash, idk, never tried.
                -->
              <Carousel SelectedIndex="{Binding SelectedTabIndex}" Grid.Column="1"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">
                <!--  Right-hand content First panel  -->
                <ScrollViewer>
                  <StackPanel IsVisible="{Binding ModulesDetected}" Spacing="20">
                    <TextBlock
                        FontSize="24"
                        FontWeight="SemiBold"
                        Margin="0,9,0,0"
                        Text="{Binding SelectedInfoModule.ModuleName}">
                      Module Name
                    </TextBlock>

                    <Border
                        Background="{DynamicResource SystemChromeMediumColor}"
                        CornerRadius="6"
                        HorizontalAlignment="Stretch"
                        Padding="12">
                      <StackPanel IsVisible="{Binding ModulesDetected}">
                        <StackPanel Margin="8,12" Spacing="12">
                          <TextBlock
                              FontSize="14"
                              Foreground="{DynamicResource SystemChromeGrayColor}"
                              Text="Module Options" />

                          <StackPanel Orientation="Horizontal" Spacing="8">
                            <Button
                                IsEnabled="{Binding SelectedInfoModule.InstallationState, Converter={StaticResource InstallationActiveConverter}}"
                                Content="{Binding SelectedInfoModule.InstallationState, Converter={StaticResource InstallationTextConverter}}"
                                Command="{Binding RemoteModuleInstalledCommand}"
                                CommandParameter="{Binding SelectedInfoModule}"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center">
                              Install
                            </Button>
                          </StackPanel>
                        </StackPanel>

                        <Separator />

                        <!--  Local controls for managing module settings!  -->
                        <StackPanel
                            HorizontalAlignment="Left"
                            Margin="12,12"
                            Spacing="8"
                            Width="550">
                          <Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
                            <TextBlock
                                Grid.Column="0"
                                HorizontalAlignment="Left"
                                Text="Enable Module"
                                VerticalAlignment="Center" />
                            <CheckBox
                                Grid.Column="2"
                                HorizontalAlignment="Right"
                                IsChecked="{Binding SelectedInfoModule.Instantiatable, Mode=TwoWay}"
                                VerticalAlignment="Center" />
                          </Grid>
                          <Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
                            <TextBlock
                                Grid.Column="0"
                                HorizontalAlignment="Left"
                                Text="Module Load Order"
                                VerticalAlignment="Center" />
                            <NumericUpDown
                                FormatString="N0"
                                Grid.Column="2"
                                HorizontalAlignment="Right"
                                Margin="0,0,8,0"
                                Increment="1"
                                Maximum="{Binding CorrectedModuleCount}"
                                Minimum="0"
                                Background="{DynamicResource SystemBaseLowColor}"
                                ParsingNumberStyle="Integer"
                                Value="{Binding SelectedInfoModule.Order, Mode=TwoWay}"
                                Watermark="0" />
                          </Grid>
                        </StackPanel>
                      </StackPanel>
                    </Border>

                    <Border
                        Background="{DynamicResource SystemChromeMediumColor}"
                        CornerRadius="6"
                        Padding="10">
                      <StackPanel
                          IsVisible="{Binding ModulesDetected}"
                          Margin="8,8"
                          Spacing="20">
                        <TextBlock
                            FontSize="14"
                            Foreground="{DynamicResource SystemChromeGrayColor}"
                            Text="Module Information" />

                        <StackPanel Orientation="Horizontal" Spacing="20">
                          <TextBlock LineHeight="21" >
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.Author_Text}" />
                            <LineBreak />
                            <Run Text="{Binding SelectedInfoModule.AuthorName}" />
                          </TextBlock>

                          <TextBlock LineHeight="21">
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.Version_Text}" />
                            <LineBreak />
                            <Run Text="{Binding SelectedInfoModule.Version}" />
                          </TextBlock>

                          <TextBlock LineHeight="21">
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.Downloads_Text}" />
                            <LineBreak />
                            <Run Text="{Binding SelectedInfoModule.Downloads}" />
                          </TextBlock>

                          <TextBlock LineHeight="21">
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.Rating_Text}" />
                            <LineBreak />
                            <Run Text="{Binding SelectedInfoModule.Rating, StringFormat='{}{0:F2}/5'}" />
                          </TextBlock>
                          <TextBlock LineHeight="21">
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.YourRating_Text}" />
                            <LineBreak />
                            <InlineUIContainer>
                              <stars:RatingControl Margin="0,-3,0,0" NumberOfStars="5" Value="{Binding ModuleRating}" />
                            </InlineUIContainer>
                          </TextBlock>
                        </StackPanel>

                        <TextBlock>
                          <Run FontWeight="Bold" Text="{x:Static assets:Resources.ModulePage_Text}" />
                          <LineBreak />
                          <htControls:Hyperlink
                              Alias="{Binding SelectedInfoModule.ModulePageUrl}"
                              Command="{Binding OpenUrlCommand}"
                              CommandParameter="{Binding SelectedInfoModule.ModulePageUrl}"
                              Url="{Binding SelectedInfoModule.ModulePageUrl}" />
                        </TextBlock>

                        <TextBlock>
                          <Run FontWeight="Bold" Text="{x:Static assets:Resources.LastUpdated_Text}" />
                          <LineBreak />
                          <Run Text="{Binding SelectedInfoModule.LastUpdated}" />
                        </TextBlock>

                        <TextBlock TextWrapping="WrapWithOverflow">
                          <Run FontWeight="Bold" Text="{x:Static assets:Resources.Description_Text}" />
                          <LineBreak />
                          <Run Text="{Binding SelectedInfoModule.ModuleDescription}" />
                        </TextBlock>


                        <TextBlock TextWrapping="WrapWithOverflow">
                          <Run FontWeight="Bold" Text="{x:Static assets:Resources.UsageInstructions_Text}" />
                          <LineBreak />
                          <Run Text="{Binding SelectedInfoModule.UsageInstructions}" />
                        </TextBlock>
                      </StackPanel>
                    </Border>
                  </StackPanel>
                </ScrollViewer>

                <!--  Right-hand content Second panel  -->
                <ScrollViewer>
                  <StackPanel IsVisible="{Binding ModulesDetected}" Spacing="20">
                    <TextBlock
                        FontSize="24"
                        FontWeight="SemiBold"
                        Margin="0,9,0,0"
                        Text="{Binding SelectedInstalledModule.ModuleName}">
                      Module Name
                    </TextBlock>

                    <Border
                        Background="{DynamicResource SystemChromeMediumColor}"
                        CornerRadius="6"
                        HorizontalAlignment="Stretch"
                        Padding="12">
                      <StackPanel IsVisible="{Binding ModulesDetected}">
                        <StackPanel Margin="8,12" Spacing="12">
                          <TextBlock
                              FontSize="14"
                              Foreground="{DynamicResource SystemChromeGrayColor}"
                              Text="Module Options" />

                          <StackPanel Orientation="Horizontal" Spacing="8">
                            <Button
                                IsEnabled="{Binding SelectedInstalledModule.InstallationState, Converter={StaticResource InstallationActiveConverter}}"
                                Content="{Binding SelectedInstalledModule.InstallationState, Converter={StaticResource InstallationTextConverter}}"
                                Command="{Binding RemoteModuleInstalledCommand}"
                                CommandParameter="{Binding SelectedInstalledModule}"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                >
                              Install
                            </Button>
                          </StackPanel>
                        </StackPanel>

                        <Separator  />

                        <!--  Local controls for managing module settings!  -->
                        <StackPanel
                            HorizontalAlignment="Left"
                            IsVisible="{Binding #TabControl.SelectedIndex}"
                            Margin="12,12"
                            Spacing="8"
                            Width="550">
                          <Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
                            <TextBlock
                                Grid.Column="0"
                                HorizontalAlignment="Left"
                                Text="Enable Module"
                                VerticalAlignment="Center" />
                            <CheckBox
                                Grid.Column="2"
                                HorizontalAlignment="Right"
                                IsChecked="{Binding SelectedInstalledModule.Instantiatable, Mode=TwoWay}"
                                VerticalAlignment="Center" />
                          </Grid>
                          <Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
                            <TextBlock
                                Grid.Column="0"
                                HorizontalAlignment="Left"
                                Text="Module Load Order"
                                VerticalAlignment="Center" />
                            <NumericUpDown
                                FormatString="N0"
                                Grid.Column="2"
                                HorizontalAlignment="Right"
                                Margin="0,0,8,0"
                                Increment="1"
                                Maximum="{Binding CorrectedModuleCount}"
                                Minimum="0"
                                Background="{DynamicResource SystemBaseLowColor}"
                                ParsingNumberStyle="Integer"
                                Value="{Binding SelectedInstalledModule.Order, Mode=TwoWay}"
                                Watermark="0" />
                          </Grid>
                        </StackPanel>
                      </StackPanel>
                    </Border>

                    <Border
                        Background="{DynamicResource SystemChromeMediumColor}"
                        CornerRadius="6"
                        Padding="10">
                      <StackPanel
                          IsVisible="{Binding ModulesDetected}"
                          Margin="8,8"
                          Spacing="20">
                        <TextBlock
                            FontSize="14"
                            Foreground="{DynamicResource SystemChromeGrayColor}"
                            Text="Module Information" />

                        <StackPanel Orientation="Horizontal" Spacing="20">
                          <TextBlock LineHeight="21" >
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.Author_Text}" />
                            <LineBreak />
                            <Run Text="{Binding SelectedInstalledModule.AuthorName}" />
                          </TextBlock>

                          <TextBlock LineHeight="21">
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.Version_Text}" />
                            <LineBreak />
                            <Run Text="{Binding SelectedInstalledModule.Version}" />
                          </TextBlock>

                          <TextBlock LineHeight="21">
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.Downloads_Text}" />
                            <LineBreak />
                            <Run Text="{Binding SelectedInstalledModule.Downloads}" />
                          </TextBlock>

                          <TextBlock LineHeight="21">
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.Rating_Text}" />
                            <LineBreak />
                            <Run Text="{Binding SelectedInstalledModule.Rating, StringFormat='{}{0:F2}/5'}" />
                          </TextBlock>
                          <TextBlock LineHeight="21">
                            <Run FontWeight="Bold" Text="{x:Static assets:Resources.YourRating_Text}" />
                            <LineBreak />
                            <InlineUIContainer>
                              <stars:RatingControl
                                 Margin="0,-3,0,0"
                                 NumberOfStars="5"
                                 Value="{Binding SelectedInstalledModuleRating}"
                                 RatingCommand="{Binding SetModuleRatingCommand}"
                                 RatingCommandParameter="{Binding SelectedInstalledModule}"/>
                            </InlineUIContainer>
                          </TextBlock>
                        </StackPanel>

                        <TextBlock>
                          <Run FontWeight="Bold" Text="{x:Static assets:Resources.ModulePage_Text}" />
                          <LineBreak />
                          <htControls:Hyperlink
                              Alias="{Binding SelectedInstalledModule.ModulePageUrl}"
                              Command="{Binding OpenUrlCommand}"
                              CommandParameter="{Binding SelectedInstalledModule.ModulePageUrl}"
                              Url="{Binding SelectedInstalledModule.ModulePageUrl}" />
                        </TextBlock>

                        <TextBlock>
                          <Run FontWeight="Bold" Text="{x:Static assets:Resources.LastUpdated_Text}" />
                          <LineBreak />
                          <Run Text="{Binding SelectedInstalledModule.LastUpdated}" />
                        </TextBlock>

                        <TextBlock TextWrapping="WrapWithOverflow">
                          <Run FontWeight="Bold" Text="{x:Static assets:Resources.Description_Text}" />
                          <LineBreak />
                          <Run Text="{Binding SelectedInstalledModule.ModuleDescription}" />
                        </TextBlock>


                        <TextBlock TextWrapping="WrapWithOverflow">
                          <Run FontWeight="Bold" Text="{x:Static assets:Resources.UsageInstructions_Text}" />
                          <LineBreak />
                          <Run Text="{Binding SelectedInstalledModule.UsageInstructions}" />
                        </TextBlock>
                      </StackPanel>
                    </Border>
                  </StackPanel>

                </ScrollViewer>

                <ScrollViewer>
                  <DockPanel>
                    <TextBox
                        DockPanel.Dock="Top"
                        FontSize="24"
                        FontWeight="SemiBold"
                        HorizontalAlignment="Stretch"
                        Margin="0,9,0,0"
                        Text="{Binding SelectedProfileName, Mode=TwoWay}"/>
                    <TextBlock
                        IsVisible="{Binding SelectedProfileNameError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                        DockPanel.Dock="Top"
                        Text="{Binding SelectedProfileNameError}"/>
                    <Border
                        DockPanel.Dock="Top"
                        Margin="0,20,0,0"
                        Background="{DynamicResource SystemChromeMediumColor}"
                        CornerRadius="6,6,6,6"
                        VerticalAlignment="Stretch"
                        Padding="12,12,12,12">
                      <Grid
                        ColumnDefinitions="*, *"
                        VerticalAlignment="Stretch">
                        <Grid
                          Grid.Column="0"
                          Margin="0,0,10,0"
                          VerticalAlignment="Stretch">
                          <ListBox
                              x:Name="LocalListBox1"
                              Classes="draggable"
                              MaxHeight="400"
                              SelectionMode="AlwaysSelected"
                              ItemsSource="{Binding SelectedProfile.Modules}">
                            
                              <ListBox.ItemTemplate>
                                <DataTemplate x:DataType="models:InstallableTrackingModule">
                                  <Grid ColumnDefinitions="*, Auto">
                                    <TextBlock
                                      Grid.Column="0"
                                      Text="{Binding ModuleName}"/>
                                    <Button
                                        IsEnabled="{Binding #LocalListBox2.((vm:ModuleRegistryViewModel)DataContext).SelectedProfile,
                                                    Converter={x:Static ObjectConverters.IsNotNull}}"
                                        Grid.Column="1"
                                        Width="32"
                                        Height="32"
                                        ToolTip.Tip="Clear"
                                        Command="{Binding #LocalListBox2.((vm:ModuleRegistryViewModel)DataContext).RemoveModuleFromSelectedProfileCommand}"
                                        CommandParameter="{Binding}"
                                        Content="-&gt;"/>
                                  </Grid>
                                </DataTemplate>
                              </ListBox.ItemTemplate>
                          </ListBox>
                        </Grid>
                        <Grid
                          Grid.Column="1"
                          Margin="10,0,0,0"
                          VerticalAlignment="Stretch">
                          <ListBox
                              x:Name="LocalListBox2"
                              Classes="draggable"
                              MaxHeight="400"
                              SelectionMode="AlwaysSelected"
                              ItemsSource="{Binding ModulesAvaliableForProfile}"
                              SelectedItem="{Binding SelectedProfileInstalledModule, Mode=TwoWay}">
                            <ListBox.ItemTemplate>
                              <DataTemplate x:DataType="models:InstallableTrackingModule">
                                <Grid ColumnDefinitions="Auto, *">
                                  <Button
                                      IsEnabled="{Binding #LocalListBox2.((vm:ModuleRegistryViewModel)DataContext).SelectedProfile,
                                                  Converter={x:Static ObjectConverters.IsNotNull}}"
                                      Grid.Column="0"
                                      Width="32"
                                      Height="32"
                                      ToolTip.Tip="Clear"
                                      Command="{Binding #LocalListBox2.((vm:ModuleRegistryViewModel)DataContext).AddModuleToSelectedProfileCommand}"
                                      CommandParameter="{Binding}"
                                      Content="&lt;-"/>
                                  <TextBlock
                                      Grid.Column="1"
                                      Text="{Binding ModuleName}"/>
                                </Grid>
                              </DataTemplate>
                            </ListBox.ItemTemplate>
                          </ListBox>
                        </Grid>
                      </Grid>
                    </Border>
                  </DockPanel>
                </ScrollViewer>
              </Carousel>
            </Grid>
          </Grid>
        </controls:ContentExample>
      </StackPanel>

    </StackPanel>

  </ScrollViewer>

</UserControl>

